<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="">
    <title>Đăng Ký</title>
    <link rel="shortcut icon" href="/sources/imgs/home/short-cut.png" type="image/x-icon">
    <link rel="stylesheet" href="/sources/css/bootstrap.min.css">
    <link rel="stylesheet" href="/sources/cssFolder/index.css" />
    <link rel="stylesheet" href="/sources/fontawesome-free-5.12.1-web/css/all.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css">
    <style>
        .custom-body {
            background-color: #f7f7f7;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .custom-main {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .custom-hr {
            margin: 20px 0;
        }

        .custom-img {
            margin: 10px;
        }
    </style>

</head>

<body style="background-color: #eae5d6;">
    <header class="header_content">
        <!-- Phần logo và tính năng header -->
        <div
            class="header_top d-flex flex-row align-items-center justify-content-around bg-black text-center text-secondary">
            <div class="header_top_logo" style="padding-left: 25px" id="top">
                <a href="../index.html"><img src="/sources/imgs/home/logo.png" width="150px" alt="" /></a>
            </div>
            <div class="col-md-7 mx-auto">
                <div class="input-group">
                    <input onkeypress="searchHandle(event)" id="header-search"
                        class="form-control border-end-0 border rounded-pill header__search-input" type="search"
                        placeholder="Vui lòng nhập sản phẩm tìm kiếm" />
                    <span class="input-group-append">
                        <button onclick="searchClick(event)"
                            class="btn btn-outline-secondary bg-white border-bottom-0 border rounded-pill ms-n5"
                            type="button">
                            <i class="fa fa-search"></i>
                        </button>
                    </span>
                    <!-- History search box -->
                    <div class="header__search-history">
                        <h3 class="header__search-history-heading">Lịch sử tìm kiếm</h3>
                        <ul class="header__search-history-list">
                            <!-- <li class="header__search-history-item">
                    <a href="#">
                      BẬT MÍ 5.5 - SĂN TRƯỚC MÃ 5.5
                      <img src="https://cf.shopee.vn/file/491389dce9eabc3510a3e8a21cc40ef7" alt="Sale" />
                      <i class="fas fa-times"></i>
                    </a>
                  </li> -->
                        </ul>
                    </div>
                </div>
            </div>
            <div class="header_top_function">
                <ul class="d-flex flex-row list-group" style="margin-right: 20px">
                    <li class="list-group-item text-secondary boder-none text-white poiter">
                        <div class="tnh-country-flag">
                            <img src="https://s.alicdn.com/@u/mobile/g/common/flags/1.0.0/assets/vn.png" height="20px"
                                loading="lazy" />
                            <span> VN <i class="fas fa-angle-down"></i></span>
                        </div>
                    </li>
                    <li onmouseenter="showListMess()"
                        class="list-group-item text-secondary boder-none text-white poiter mess-icon-container">
                        <span><i class="fas fa-comments"></i></span>
                        <div class="mess-container">
                            <h2 class="text-secondary" style="margin-bottom: 8px;">Tin nhắn</h2>
                            <!-- <p class="text-secondary">Không có tin nhắn nào</p> -->
                            <ul class="mess-box"></ul>
                        </div>
                    </li>
                    <li onmouseenter="showListNotice()"
                        class="list-group-item text-secondary boder-none text-white header__navbar-item--has-notify poiter">
                        <span><i class="fas fa-bell"></i></span>
                        <!-- Header Notification  -->
                        <div class="header__notify">
                            <header class="header__notify-header">
                                <h3>Thông báo mới nhận</h3>
                            </header>
                            <ul class="header__notify-list"></ul>
                            <footer class="header__notify-footer">
                                <a href="#" class="header__notify-footer-btn">
                                    Xem thêm
                                </a>
                            </footer>
                        </div>
                    </li>
                    <li onmouseenter="showCart()" class="list-group-item text-secondary boder-none text-white">
                        <div class="header__cart-wrap">
                            <i class="header__cart-icon fas fa-shopping-cart"></i>

                            <div class="header__cart-list">
                                <!-- <h4 class="header__cart-heading text-center">Sản phẩm đã thêm</h4>
                    
                    <img src="/sources/imgs/home/cart-empty.png" alt="No cart" class="header__cart-list--no-cart header__cart-no-cart-img" />
                    <span class="header__cart-list--no-cart header__cart-no-cart-msg">Chưa có sản phẩm</span>
                    <ul class="header__cart-list-item"></ul>
                    
                    <a href="#" class="header__cart-view-cart btn btn--primary">Xem giỏ hàng</a> -->
                            </div>
                            <span class="header__cart-notice"></span>
                        </div>
                    </li>
                    <li id="stateLogin"
                        class="list-group-item text-secondary rounded-pill bg-orange text-white user-icon-container poiter">
            </div>
            </li>
            </ul>
        </div>
        </div>
        <!-- Phần navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
            <div class="container-fluid">
                <div class="collapse navbar-collapse" id="ftco-nav">
                    <ul class="navbar-nav m-auto">
                        <li class="nav-item active">
                            <a href="../index.html" class="nav-link">Home</a>
                        </li>
                        <li class="nav-item">
                            <a href="/Pages/product.html" class="nav-link">Product</a>
                        </li>
                        <!-- <li class="nav-item"><a href="#information" class="nav-link">Blog</a></li> -->
                        <li class="nav-item">
                            <a href="#footer" class="nav-link">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <div class="custom-body" style="height: fit-content;padding: 15px;background-color: #eae5d6;">
            <main class="custom-main">
                <form action="" method="post" enctype="" id="registrationForm" class="was-validated" target="_blank">
                    <fieldset class="border-0" style="width: 35vw;">
                        <legend style="text-align: center;" class="font-weight-bold mb-3">
                            <h3>ĐĂNG KÝ</h3>
                        </legend>

                        <div style="text-align: center;">
                            <a href="https://www.facebook.com" target="_blank">
                                <img src="../sources/imgs/pictures/fb.png" alt="Facebook" class="custom-img"
                                    width="50vh">
                            </a>
                            <a href="https://www.google.com" target="_blank">
                                <img src="../sources/imgs/pictures/google.png" alt="Google" class="custom-img"
                                    width="50vh">
                            </a>
                        </div>
                        <hr class="custom-hr">
                        <div class="form-group">
                            <label for="fullName">Họ và tên</label>
                            <input type="text" id="fullName" class="form-control" placeholder="Nhập họ tên" required
                                pattern="^\S.*\S$|^\S$" style="border-radius: 5px;">
                            <div class="invalid-feedback" id="fullNameAlert">Vui lòng điền họ và tên.</div>
                        </div>

                        <div class="form-group">
                            <label for="userName">Tên đăng nhập</label>
                            <input type="text" id="userName" class="form-control" placeholder="Nhập tên đăng nhập"
                                pattern="^[a-zA-Z_][a-zA-Z0-9_]{3,15}$" required style="border-radius: 5px;"
                                minlength="6" maxlength="16">
                            <div class="invalid-feedback" id="userNameAlert">Vui lòng điền tên đăng nhập.</div>
                        </div>

                        <div class="form-group">
                            <label for="passwordFormSignUp">Mật khẩu</label>
                            <div class="input-group">
                                <input type="password" id="passwordFormSignUp" class="form-control"
                                    placeholder="Nhập mật khẩu" required minlength="6" maxlength="18"
                                    style="border-top-left-radius: 5px; border-bottom-left-radius: 5px;">
                                <span class="input-group-text" id="togglePasswordFormSignUp"
                                    style="cursor: pointer; background-color: #fff; border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
                                    <i class="bi bi-eye-slash"></i>
                                </span>
                                <div class="invalid-feedback" id="passwordFormSignUpAlert1">Vui lòng nhập mật khẩu.
                                </div>
                                <div class="invalid-feedback" id="passwordFormSignUpAlert2"></div>
                                <div class="invalid-feedback" id="passwordFormSignUpAlert3"></div>
                                <div class="invalid-feedback" id="passwordFormSignUpAlert4"></div>
                                <div class="invalid-feedback" id="passwordFormSignUpAlert5"></div>
                                <div class="invalid-feedback" id="passwordFormSignUpAlert6"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Xác nhận mật khẩu</label>
                            <div class="input-group">
                                <input type="password" id="confirmPassword" class="form-control"
                                    placeholder="Nhập mật khẩu" required pattern="^$" maxlength="18"
                                    style="border-top-left-radius: 5px; border-bottom-left-radius: 5px;">
                                <span class="input-group-text" id="toggleConfirmPassword"
                                    style="cursor: pointer; background-color: #fff; border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
                                    <i class="bi bi-eye-slash"></i>
                                </span>
                                <div class="invalid-feedback" id="confirmPasswordAlert">Phần mật khẩu chưa hoàn thiện.
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" class="form-control" placeholder="Nhập email" required
                                style="border-radius: 5px;">
                            <div class="invalid-feedback" id="emailAlert">Vui lòng điền email.</div>
                        </div>

                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="terms" required>
                            <label class="form-check-label" for="terms">Thông qua việc tạo tài khoản, bạn đồng ý với
                                <br> <a href="#">Điều khoản & Quyền riêng tư của chúng tôi.</a></label>
                        </div>
                        <div>
                            <button type="submit" class="btn btn-primary" id="submitButton" style="float: left;">Đăng
                                Ký</button>
                            <a href="login.html" style="float: right;">Đăng nhập ngay</a>
                        </div>
                    </fieldset>
                </form>
            </main>
        </div>
    </div>
    <!-- Phần Footer -->
    <footer class="bg-dark text-center text-lg-start text-white" id="footer">
        <div class="container p-4">
            <div class="row mt-4">
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase">Chính sách</h5>

                    <ul class="list-unstyled mb-0">
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-user-lock fa-fw fa-sm me-2"></i>Chính sách bảo mật</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-shipping-fast fa-fw fa-sm me-2"></i>Chính sách vận chuyển</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-hands-helping fa-fw fa-sm me-2"></i>Chính sách đổi trả</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-book fa-fw fa-sm me-2"></i>Điều
                                khoản sử dụng</a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase">Kết nối với chúng tôi</h5>

                    <ul class="list-unstyled">
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fab fa-facebook-f fa-fw fa-sm me-2"></i>Facebook</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fab fa-instagram fa-fw fa-sm me-2"></i>Instagram</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fab fa-twitter fa-fw fa-sm me-2"></i>Twitter</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fab fa-youtube fa-fw fa-sm me-2"></i>YouTube</a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase">Thông tin liên hệ</h5>

                    <ul class="list-unstyled">
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-school fa-fw fa-sm me-2"></i>Trường
                                đại học Cần Thơ</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-road fa-fw fa-sm me-2"></i>Khu II,
                                Đ. 3 Tháng 2, Xuân Khánh, Ninh Kiều, Cần Thơ</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-map-marker-alt fa-fw fa-sm me-2"></i>Trường CNTT-TT</a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase">Hỗ trợ khách hàng</h5>

                    <ul class="list-unstyled">
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-phone-alt fa-fw fa-sm me-2"></i>Hotline: +84 123 456 789 (24/7)</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-envelope fa-fw fa-sm me-2"></i>Email: thelightshop@gmail.com</a>
                        </li>
                        <li>
                            <a href="#!" class="text-white text-decoration-none"><i
                                    class="fas fa-question fa-fw fa-sm me-2"></i>Câu
                                hỏi thường gặp (FAQ)</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <a href="#top" class="scroll-top-btn" id="top-button">
            <i class="fas fa-arrow-alt-circle-up"></i>
        </a>
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2)">
            © 2024 CT188:
            <a class="text-white" href="#">Nhóm 7</a>
        </div>
    </footer>
    <!-- lấy jSon userList -->
    <script>
        let userList = JSON.parse(localStorage.getItem('userList')) || [];
    </script>

    <!-- kiểm tra họ tên  -->
    <script>
        let fullName = document.getElementById('fullName');
        let fullNameAlert = document.getElementById('fullNameAlert');
        fullName.oninput = function () {
            if (fullName.value.length == 0) fullNameAlert.innerText = "Vui lòng điền họ và tên.";
            else fullNameAlert.innerText = "Tên không hợp lệ.";
        }
    </script>

    <!-- kiểm tra phần tên đăng nhập -->
    <script>

        let userName = document.getElementById('userName');
        let userNameAlert = document.getElementById('userNameAlert');
        // kiểm tra tên đăng nhập đã tồn tại hay chưa
        userName.oninput = function (event) {
            // kiểm tra tính hợp lệ 
            if (userName.value.length == 0) {
                userNameAlert.innerText = "Vui lòng điền tên đăng nhập.";
                return;
            } else {
                userNameAlert.innerText = `Yêu cầu tối thiểu 4 ký tự và ký tự đầu tiên không phải chữ số.
                                            Chỉ được dùng các chữ cái không dấu, chữ số và dấu gạch dưới _.`;
            }
            for (let i = 0; i < userList.length; ++i) {
                if (userName.value == userList[i].userName) {
                    userNameAlert.innerText = "Tên đăng nhập đã tồn tại.";
                    userName.pattern = "^$";
                    return;
                }
            }

            userName.pattern = "^[a-zA-Z_][a-zA-Z0-9_]{3,15}$";
        }
    </script>
    <!-- kiểm tra phần nhập mật khẩu và xác nhận mật khẩu -->
    <script>
        let passwordFormSignUp = document.getElementById('passwordFormSignUp');
        // Thiết lập pattern cho mật khẩu
        passwordFormSignUp.setAttribute('pattern', "^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[@$!%*?&_])[A-Za-z0-9@$!%*?&_]{8,}$");

        passwordFormSignUp.oninput = function (event) {
            let passVal = passwordFormSignUp.value;

            // Kiểm tra mật khẩu trống
            if (passVal.length == 0) {
                document.getElementById('passwordFormSignUpAlert1').innerText = "Vui lòng nhập mật khẩu";
                document.getElementById('passwordFormSignUpAlert2').innerText = "";
                document.getElementById('passwordFormSignUpAlert3').innerText = "";
                document.getElementById('passwordFormSignUpAlert4').innerText = "";
                document.getElementById('passwordFormSignUpAlert5').innerText = "";
                document.getElementById('passwordFormSignUpAlert6').innerText = "";
                return; // Dừng lại nếu mật khẩu trống
            }

            // Kiểm tra độ dài mật khẩu
            if (passVal.length < 6) {
                document.getElementById('passwordFormSignUpAlert1').innerText = "Yêu cầu tối thiểu 6 ký tự";
            } else {
                document.getElementById('passwordFormSignUpAlert1').innerText = "";
            }

            // Khởi tạo các biến kiểm tra
            let checkinhoa = false;
            let checkinthuong = false;
            let checkchuso = false;
            let checkkitudacbiet = false;
            let checkkitukhac = false;

            // Kiểm tra các điều kiện mật khẩu
            for (let i = 0; i < passVal.length; ++i) {
                if (/[A-Z]/.test(passVal[i])) checkinhoa = true; // Kiểm tra chữ hoa
                if (/[a-z]/.test(passVal[i])) checkinthuong = true; // Kiểm tra chữ thường
                if (/[0-9]/.test(passVal[i])) checkchuso = true; // Kiểm tra số
                if (/[@$!%*?&_]/.test(passVal[i])) checkkitudacbiet = true; // Kiểm tra ký tự đặc biệt
                if (/[^A-Za-z0-9@$!%*?&_]/.test(passVal[i])) checkkitukhac = true;
            }

            // Thêm/xóa thông báo
            document.getElementById('passwordFormSignUpAlert2').innerText = checkinhoa ? '' : 'Ít nhất một chữ cái in hoa trong bảng chữ cái tiếng Anh.';
            document.getElementById('passwordFormSignUpAlert3').innerText = checkinthuong ? '' : 'Ít nhất một chữ cái in thường trong bảng chữ cái tiếng Anh.';
            document.getElementById('passwordFormSignUpAlert4').innerText = checkchuso ? '' : 'Ít nhất một chữ số từ 0 đến 9.';
            document.getElementById('passwordFormSignUpAlert5').innerText = checkkitudacbiet ? '' : 'Ít nhất một ký tự đặc biệt thuộc @ $ ! % * ? & _';
            document.getElementById('passwordFormSignUpAlert6').innerText = !checkkitukhac ? '' : 'Không đặt bất kì ký tự nào không thuộc các nhóm trên';

            // đặt thông báo cho phần xác nhận mật khẩu trong trường hợp đúng và sai ở phần mật khẩu
            let confirmPassword = document.getElementById('confirmPassword');
            if (passVal.length < 8 || !checkinhoa || !checkinthuong || !checkchuso || !checkkitudacbiet || checkkitukhac) {
                document.getElementById('confirmPasswordAlert').innerText = "Phần mật khẩu chưa hoàn thiện";
                confirmPassword.pattern = "^$";
            } else {
                document.getElementById('confirmPasswordAlert').innerText = "Mật khẩu không khớp";
                confirmPassword.pattern = "^" + passwordFormSignUp.value + "$";
            }
        };
    </script>
    <!-- xem mật khẩu và xem xác nhận mật khẩu -->
    <script>
        function see(event) {
            const passwordInput = event.currentTarget.id === 'togglePasswordFormSignUp'
                ? document.getElementById('passwordFormSignUp')
                : document.getElementById('confirmPassword');
            const icon = event.currentTarget.querySelector('i'); // Truy cập vào icon bên trong phần tử được nhấn

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text'; // Hiển thị mật khẩu
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye'); // Chuyển biểu tượng sang mắt mở
            } else {
                passwordInput.type = 'password'; // Ẩn mật khẩu
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash'); // Chuyển biểu tượng sang mắt đóng
            }
        }
        document.getElementById('togglePasswordFormSignUp').addEventListener('click', see);
        document.getElementById('toggleConfirmPassword').addEventListener('click', see);
    </script>

    <!-- kiểm tra email -->
    <script>
        let email = document.getElementById('email');
        let emailAlert = document.getElementById('emailAlert');
        email.oninput = function () {
            if (email.value.length == 0) {
                emailAlert.innerText = "Vui lòng điền email.";
                return;
            } else {
                emailAlert.innerText = "email chưa đúng định dạng.";
            }

            for (let i = 0; i < userList.length; ++i) {
                if (email.value == userList[i].email) {
                    emailAlert.innerText = "Email đã tồn tại.";
                    email.pattern = "^$";
                    return;
                }
            }

            email.pattern = "^.*$";
        }
    </script>

    <!-- set onsubmit cho form -->
    <script>
        newUser = document.getElementById('registrationForm');
        newUser.onsubmit = function (event) {
            event.preventDefault();

            userList.push(
                {
                    fullName: document.getElementById('fullName').value,
                    userName: document.getElementById('userName').value,
                    pwd: document.getElementById('confirmPassword').value,
                    email: document.getElementById('email').value,
                    phoneNum: "",
                    gender: "orther",
                    address: "",
                    data: {
                        cart: [],
                        ordersPlaced: [],
                        ordersPaid: [],
                        notificationsReceived: []
                    }
                }
            );
            let userListJson = JSON.stringify(userList);
            localStorage.setItem('userList', userListJson);
            let currentUser = userList.length - 1;
            localStorage.setItem('currentUser', currentUser);
            window.location.replace("registration_success.html");
        }        
    </script>
    <script>
        // Kiểm tra đã đăng nhập chưa
        window.onload = (e) => {
          if (typeof localStorage["searchData"] === "undefined") {
            localStorage.setItem("searchData", JSON.stringify([]));
          }
          if (typeof localStorage["curSearch"] === "undefined") {
            localStorage.setItem("curSearch", "");
          }
          if (typeof localStorage["currentUser"] === "undefined") {
            localStorage.setItem("currentUser", "-1");
          }
          let temp = productList.filter(product => userActive.data.cart.includes(product.id)).length
          const headerNotice = document.querySelector('.header__cart-notice');
          if (temp > 0) {
            headerNotice.style.display = "block";
            headerNotice.innerText = `${temp}`;
          } else headerNotice.style.display = "none";
        }
        const curUser = window.localStorage.getItem("currentUser");
        // reset trang khi đổi trạng thái đăng nhập
        window.addEventListener("storage", (event) => {
          if (event.key === 'currentUser' && event.newValue !== curUser) location.reload();
        });
    
    
        // Lấy danh sách user và sản phẩm
        // const userList = JSON.parse(window.localStorage.getItem("userList")) || [];
        const productList = JSON.parse(localStorage.getItem('productList')) || [];
        let userActive = userList[parseInt(curUser)];
    
    
    
        // Trạng thái đăng nhập
        document.addEventListener('DOMContentLoaded', () => {
          var userState = document.querySelector('#stateLogin');
          if (curUser == "-1") {
            userState.innerHTML = `<i class="fas fa-user"></i>
                  <span onclick="toLogin(event)">Sign in</span>
                  <div class="login-container" >
                    <h2 class="text-secondary">Sign back in to continue</h2>
                    <button class="sign-in-btn rounded-pill "onclick="toLogin(event)">Sign in</button>
                    <p class="text-secondary">Or register to create a new account:</p>
                    <button class="sign-in-btn rounded-pill" onclick="toSignup(event)">Register</button>
                    <p class="agreement">
                      I agree to the
                      <a href="#">TheLight.com Free Membership Agreement</a> and
                      <a href="#">Privacy Policy.</a>
                    </p>`;
          }
          else {
            userState.innerHTML = `<li class="header__navbar-item header__navbar-user">
                                <img src="https://i.pinimg.com/736x/13/2e/a7/132ea72d2bc3b85d90409c9e8f2d0f4a.jpg" alt=""
                                    class="header__navbar-user-img">
                                <span class="header__navbar-user-name">${userActive.fullName}</span>
                                <ul class="header__navbar-user-menu">
                                    <li class="header__navbar-user-item">
                                        <a href="/Pages/profile.html" onclick="stateProfile('user')">Tài khoản của tôi</a>
                                    </li>
                                    <li class="header__navbar-user-item header__navbar-user-item--separate">
                                        <a href="#" onclick="logout()">Đăng xuất</a>
                                    </li>
                                </ul>
                            </li>`;
          }
        })
    
        // Tin nhắn
        var showListMess = (e) => {
          const ulMess = document.querySelector('.mess-box');
          if (curUser == "-1") {
            if (!ulMess.querySelector('.header__mess-item')) {
              let li = document.createElement('li');
              li.classList.add("header__mess-item", "header__mess-item--viewed");
              li.innerHTML = `<a onclick="toLogin(event)" class='header__mess-link justify-content-center' href='login.html'>Vui lòng đăng nhập để xem tin nhắn</a>`;
              ulMess.appendChild(li);
            }
          } else {
            if (!ulMess.querySelector('p')) ulMess.innerHTML = `<p class="text-secondary">Không có tin nhắn nào</p>`;
          }
        }
        // Thông báo
        let currentNoticeCount = 4;
        var showListNotice = (e) => {
          const ulMess = document.querySelector('.header__notify-list');
          const messFooter = document.querySelector(".header__notify-footer-btn");
    
          if (curUser == "-1") {
            messFooter.classList.remove("show");
            if (!ulMess.querySelector('.header__notify-item')) {
              let li = document.createElement('li');
              li.classList.add("header__notify-item", "header__notify-item--viewed");
              li.innerHTML = `<a onclick="toLogin(event)" class='header__notify-link justify-content-center' href='login.html'>Vui lòng đăng nhập để xem thông báo</a>`;
              ulMess.appendChild(li);
            }
          } else {
            ulMess.innerHTML = "";
            let productOfNoctify = productList.filter(product =>
              userActive.data.notificationsReceived.includes(product.id)
            );
            for (let i = productOfNoctify.length - 1; i >= Math.max(0, productOfNoctify.length - currentNoticeCount); i--) {
              let li = document.createElement('li');
              li.classList.add("header__notify-item", "header__notify-item--viewed");
              li.innerHTML = `<a href="#" class="header__notify-link">
                        <img src="/sources/Data/${productOfNoctify[i].id}/1.webp" alt=""
                          class="header__notify-img" />
                        <div class="header__notify-info">
                          <span class="header__notify-name">${productOfNoctify[i].nameProduct}</span>
                          <span class="header__notify-description">Đã được xác nhận</span>
                        </div>
                      </a>`;
              ulMess.appendChild(li);
            }
    
            if (currentNoticeCount <= 5) {
              let li = document.createElement('li');
              li.classList.add("header__notify-item", "header__notify-item--viewed");
              li.innerHTML = `<a href="#" class="header__notify-link">
                        <img src="/sources/imgs/home/notice_welcom.webp" alt=""
                          class="header__notify-img" />
                        <div class="header__notify-info">
                          <span class="header__notify-name">Chào mừng bạn đến với The Light Shop</span>
                          <span class="header__notify-description">Rất vui được phục vụ bạn</span>
                        </div>
                      </a>`;
              ulMess.appendChild(li);
            }
    
            messFooter.classList.add("show");
          }
        };
        document.querySelector('.header__notify-footer-btn').addEventListener('click', (event) => {
          event.preventDefault();
          currentNoticeCount += 5;
          showListNotice();
        });
        //  Giỏ hàng 
        var showCart = (e) => {
          const cartContainer = document.querySelector('.header__cart-wrap');
          const cartList = document.querySelector('.header__cart-list');
          cartList.innerHTML = `<h4 class="header__cart-heading text-center">Sản phẩm đã thêm</h4>`;
          if (curUser == "-1") {
            let ul = document.createElement('ul');
            ul.classList.add("header__cart-list-item");
            cartList.appendChild(ul);
            const ulCart = document.querySelector('.header__cart-list-item');
            if (!ulCart.querySelector('.header__notify-item--viewed')) {
              let li = document.createElement('li');
              li.classList.add("header__notify-item", "header__notify-item--viewed");
              li.innerHTML = `<a onclick="toLogin(event)" class='header__notify-link justify-content-center' href='login.html'>Vui lòng đăng nhập để xem sản phẩm</a>`;
              ulCart.appendChild(li);
              document.querySelector('.header__cart-notice').style.display = "none";
            }
          } else {
            let productOfCart = productList.filter(product =>
              userActive.data.cart.includes(product.id));
            const divCart = document.querySelector('.header__cart-wrap');
            if (productOfCart.length == 0) {
              cartList.innerHTML = `<h4 class="header__cart-heading text-center">Sản phẩm đã thêm</h4>
                      <img src="/sources/imgs/home/cart-empty.png" alt="No cart" class="header__cart-list--no-cart header__cart-no-cart-img" />
                      <span class="header__cart-list--no-cart header__cart-no-cart-msg">Chưa có sản phẩm</span>`
              document.querySelector('.header__cart-notice').style.display = "none";
            } else {
              let ul = document.createElement('ul');
              ul.classList.add("header__cart-list-item");
              cartList.appendChild(ul);
              let a = document.createElement('a');
              a.classList.add("header__cart-view-cart", "btn", "btn--primary");
              a.setAttribute("href", "/Pages/profile.html");
              a.onclick=stateProfile("cart");
              a.innerText = "Xem giỏ hàng";
              cartList.appendChild(a);
              const ulCart = document.querySelector('.header__cart-list-item');
              ulCart.innerHTML = "";
              const headerNotice = document.querySelector('.header__cart-notice');
              headerNotice.style.display = "block";
              headerNotice.innerText = `${productOfCart.length}`;
              for (let i = productOfCart.length - 1; i >= Math.max(0, productOfCart.length - 5); i--) {
                let li = document.createElement('li');
                li.classList.add("header__cart-item");
                li.innerHTML = `<img
                                src="/sources/Data/${productOfCart[i].id}/1.webp"
                                alt="" class="header__cart-img" />
                              <div class="header__cart-item-info">
                                <div class="header__cart-item-head">
                                  <h5 class="header__cart-item-name">
                                    ${productOfCart[i].nameProduct}
                                  </h5>
                                  <div class="divheader__cart-item-price-wrap">
                                    <span class="header__cart-item-price">${formatNumber(productOfCart[i].price)} VND</span>
                                    <span class="header__cart-item-multiply">x</span>
                                    <span class="header__cart-item-cnt">1</span>
                                  </div>
                                </div>
                                <div class="header__cart-item-body">
                                  <span class="header__cart-item-description">
                                    Phân loại: ${productOfCart[i].type}
                                    </span>
                                    <span class="header__cart-item-remove" onclick="delCartItem('${productOfCart[i].id}')">Xóa</span>
                                </div>
                              </div>`;
                ulCart.appendChild(li);
              }
            }
          }
        }
        var stateProfile = (sta) => {
          localStorage.setItem("stateProflie",sta);
        }
        var delCartItem = (itemId) => {
          userList[parseInt(curUser)].data.cart = userList[parseInt(curUser)].data.cart.filter(item => item !== itemId);
          localStorage.setItem("userList", JSON.stringify(userList));
          location.reload();
          return;
        }
    
        function formatNumber(num) {
          return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }
    
        // Lắng nghe sự kiện cuộn lên
        window.onscroll = function () {
          let topButton = document.getElementById("top-button");
          if (
            document.body.scrollTop > 200 ||
            document.documentElement.scrollTop > 200
          ) {
            topButton.classList.add("show");
          } else {
            topButton.classList.remove("show");
          }
        };
    
        // Đăng xuất
        var logout = () => {
          window.localStorage.setItem('currentUser', "-1");
          if (typeof localStorage["adClosedDate"] !== "undefined") localStorage.removeItem("adClosedDate");
          location.reload();
        }
        // xư kiện đăng nhập đăng xuất
        var toLogin = (e) => {
          window.localStorage.setItem("currentPage", location.pathname);
          window.location.href = "login.html";
        }
        var toSignup = (e) => {
          window.localStorage.setItem("currentPage", location.pathname);
          window.location.href = "signup.html";
        }
    
        // Search input
        var searchData;
        const search = document.querySelector('#header-search');
        const ulSearch = document.querySelector('.header__search-history-list');
        var showHistory = (e) => {
          ulSearch.innerHTML = "";
          searchData = JSON.parse(localStorage.getItem("searchData"));
          for (let i = searchData.length - 1; i >= Math.max(0, searchData.length - 5); i--) {
            let li = document.createElement('li');
            li.classList.add('header__search-history-item');
            li.innerHTML = `<a  href="#" onclick="searchItem(this)">${searchData[i]}<i class="fas fa-times" onclick=delHistory(${i},event)></i></a>`;
            ulSearch.appendChild(li);
          }
        }
        var delHistory = (index, event) => {
          event.stopPropagation();
          searchData.splice(index, 1);
          window.localStorage.setItem("searchData", JSON.stringify(searchData));
          showHistory();
        }
    
    
        const searchHistory = document.querySelector('.header__search-history');
        search.addEventListener('focus', () => {
          searchHistory.style.display = 'block';
        });
    
        document.addEventListener('click', (event) => {
          if (!event.target.closest('.header__search-input') && !event.target.closest('.header__search-history') && !event.target.closest('.header__search-history-item')) {
            searchHistory.style.display = 'none';
          }
        });
        search.onfocus = showHistory();
    
    
        var searchHandle = (e) => {
          if (e.key === "Enter") {
            search.value = search.value.trim();
            if (search.value !== "") {
              searchData.push(search.value);
              window.localStorage.setItem("searchData", JSON.stringify(searchData));
              window.localStorage.setItem("curSearch", search.value);
              search.value="";
              window.location.href = "/Pages/product.html";
            }
          }
        }
        var searchClick = (e) => {
          search.value = search.value.trim();
          if (search.value !== "") {
            searchData.push(search.value);
            window.localStorage.setItem("searchData", JSON.stringify(searchData));
            window.localStorage.setItem("curSearch", search.value);
            search.value="";
            window.location.href = "/Pages/product.html";
          }
        }
        var searchItem = (item) => {
          window.localStorage.setItem("curSearch", item.textContent);
          window.location.href = "/Pages/product.html";
        }
        // đi tới trang chi tiết sản phẩm
        var goProduct = (index) => {
          window.open('Pages/product-items.html?id='+index,'_self');
        }
      </script>

</body>

</html>